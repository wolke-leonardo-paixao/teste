name: replace projectId

on:
  push:
    branches:
      - 'prod'
      - 'dev'

jobs:
    print-variable:
      runs-on: ubuntu-latest
      
      steps:
        - name: Carregar arquivo de ambiente
          uses: actions/checkout@v2
      
        - name: Get Branch Name
          run: echo "BRANCH_NAME=$(echo $GITHUB_REF | awk -F'/' '{print $3}')" >> $GITHUB_ENV
      
        - name: Set up Git
          run: |
            git config --global user.email "leonardo.paixao@wolkedatasolutions.com"
            git config --global user.name "wolke-leonardo-paixao"
      
        - name: Update script SQL with branch name
          run: |
            for file in src/*.sql; do
              if [ -f "$file" ]; then
                if [[ "$BRANCH_NAME" == "dev" ]]; then
                  sed -i "s/dlh-prd-brlm-zcb/dlh-dev-brlm-qr8/g" "$file"
                elif [[ "$BRANCH_NAME" == "prod" ]]; then
                  sed -i "s/dlh-dev-brlm-qr8/dlh-prd-brlm-zcb/g" "$file"
                else
                  echo "Branch não reconhecido: $BRANCH_NAME"
                fi
                git add "$file"
              else 
                echo "arquivo não encontrado"
              fi
            done
              
            # Verificar se há alterações para commit
            if git diff --cached --exit-code; then
              echo "Nenhuma alteração para commit."
            else
              git commit -m "Atualização automática dos identificadores de projeto"
              git push https://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@github.com/wolke-leonardo-paixao/teste $BRANCH_NAME
            fi